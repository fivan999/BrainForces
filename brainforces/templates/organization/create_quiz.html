{% extends "organization/detail.html" %}

{% block styles %}
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

  <!-- Font Awesome -->
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

  <!-- Moment.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.23.0/moment.min.js" integrity="sha256-VBLiveTKyUZMEzJd6z2mhfxIqz3ZATCuVMawPZGzIfA=" crossorigin="anonymous"></script>

  <!-- Tempus Dominus Bootstrap 4 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.1.2/css/tempusdominus-bootstrap-4.min.css" integrity="sha256-XPTBwC3SBoWHSmKasAk01c08M6sIA5gF5+sRxqak2Qs=" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.1.2/js/tempusdominus-bootstrap-4.min.js" integrity="sha256-z0oKYg6xiLq3yJGsp/LsY9XykbweQlHl42jHv2XTBz4=" crossorigin="anonymous"></script>
{% endblock %}

{% load widget_tweaks %}

{% block organization_page %}
  <form enctype="multipart/form-data" method="post">
    {% csrf_token %}
    <div class="card mb-4">
      <div class="card-header card-header-secondary">
        <h4 class="card-title">Создать викторину</h4>
      </div>
      <div class="card-body p-2">
        {% for error in form.non_field_errors %}
          <div class="alert alert-danger" role="alert">
            {{ error|safe }}
          </div>
        {% endfor %}
        {% for field in form.visible_fields %}
          <p>
            {{ field.label }}
            {% if field.name == 'description' %}
              {{ field }}<br/>
            {% elif field.name == 'start_time' %}
              <div class="input-group date gap-2" id="datetimepicker1" data-target-input="nearest">
                {{ field }}
                <div class="input-group-append d-flex" data-target="#datetimepicker1" data-toggle="datetimepicker">
                  <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                </div>
              </div>
            {% elif field.name == 'is_private' or field.name == 'is_rated' %}
              {{ field|add_class:'form-check-input' }}
            {% else %}
              {{ field|add_class:'form-control' }}
            {% endif %}
            <small><span class="text-muted">{{ field.help_text }}</span></small>
            {% for error in field.errors %}
              <div class="alert alert-danger" role="alert">
                {{ error|safe }}
              </div>
            {% endfor %}
          </p>
        {% endfor %}
      </div>
    </div>
    {{ question_formset.management_form }}
    {% for error in question_formset.non_form_errors %}
      <div class="alert alert-danger" role="alert">
        {{ error|safe }}
      </div>
    {% endfor %}
    {% for form in question_formset %}
      <div class="card mb-4">
        <div class="card-header card-header-secondary">
          <h4 class="card-title">Добавить вопрос {{ forloop.counter }}</h4>
        </div>
        <div class="card-body p-2">
          {% for field in form.visible_fields %}
            <p>
              {% if field.name != 'DELETE' %}
                {{ field.label }}
                {% if field.name == 'is_correct' %}
                  {{ field|add_class:'form-check-input' }}
                {% elif field.name == 'text' %}
                  {{ field }}<br/>
                {% else %}
                  {{ field|add_class:'form-control' }}
                {% endif %}
                <small><span class="text-muted">{{ field.help_text }}</span></small>
                {% for error in field.errors %}
                  <div class="alert alert-danger" role="alert">
                    {{ error|safe }}
                  </div>
                {% endfor %}
              {% endif %}
            </p>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
    <button type="submit" class="btn btn-primary mb-3">Создать</button>
  </form>
  <script>
    $(function () {
      $("#datetimepicker1").datetimepicker({
        format: 'DD.MM.YYYY HH:mm:ss',
      });
    });
  </script>
{% endblock organization_page %}